# Automatic Programming Assignments Grader

```
Usage of main.go:
  -schema string
        Marking scheme to follow when grading the assignment (required)
```

## Installation
First off, you'll need to [Install Go](https://golang.org/doc/install) and make sure enviornment variables are set up properly. Following that, you'll need to [Install Docker](https://docs.docker.com/v17.09/engine/installation/). To be able to run Java Style checking test tasks, you'll need to install [Checkstyle](http://checkstyle.sourceforge.net/index.html) as well.


Running the following two commands install two Go-based projects that run the grading.
```
go get -u github.com/docker-exec/dexec
go get -u github.com/johnhany97/grader
```
Note: We use a modified version of `dexec` which supports timing out executions. Changes should've been merged, however, ensure you have version `1.0.9-SNAPSHOT` of `dexec` installed before continuing.

That customized version could also be found at [https://github.com/johnhany97/dexec.git](https://github.com/johnhany97/dexec.git).

## Supported languages

Following is a list of supported languages with the required docker image.

- `C`: `dexec/lang-c`
- `Clojure`: `dexec/lang-clojure`
- `CoffeeScript`: `dexec/lang-coffee`
- `C++`: `dexec/lang-cpp`
- `C#`: `dexec/lang-csharp`
- `D`: `dexec/lang-d`
- `Erlang`: `dexec/lang-erlang`
- `F#`: `dexec/lang-fsharp`
- `Go`: `dexec/lang-go`
- `Groovy`: `dexec/lang-groovy`
- `Haskell`: `dexec/lang-haskell`
- `Java`:  `dexec/lang-java` AND `johnhany97/grader-junit`
- `Lisp`:  `dexec/lang-lisp`
- `Lua`: `dexec/lang-lua`
- `JavaScript`: `dexec/lang-node`
- `Nim`: `dexec/lang-nim`
- `Objective C`: `dexec/lang-objc`
- `OCaml`: `dexec/lang-ocaml`
- `Perl 6`: `dexec/lang-perl6`
- `Perl`: `dexec/lang-perl`
- `PHP`: `dexec/lang-php`
- `Python`: `dexec/lang-python`
- `R`: `dexec/lang-r`
- `Racket`: `dexec/lang-racket`
- `Ruby`: `dexec/lang-ruby`
- `Rust`: `dexec/lang-rust`
- `Scala`: `dexec/lang-scala`
- `Bash`: `dexec/lang-bash`

## Example usage
The following commands are to be ran from the project's root directory.
```
grader -schema="examples/inputOutput/javaSchema.json"
```
```
grader -schema="examples/python/pySchema.json"
```
```
grader -schema="examples/inputOutput/goSchema.json"
```

## Schema Properties
- `file` - Name of the file being graded, should contain it's extension - required
- `language` - Name of the programming language in which the file being graded is written - optional
- `className` - Class name of the file provided, usually is the name without the extension - required by junit and pyunit tests
- `folder` - Folder within which the file provided is located - required
- `tests` - Array of test tasks - required (even if just empty array)
- `outfile` - Whether to store results in a file or just output it in the terminal - default = ''

### Test Tasks
Currently supported are 4 different types of test tasks. They should confirm to the following format:
```JSON
{
  "type": "TYPE_OF_TEST", // io - junit - pyunit - output
  // io --- start
  "input": [ " " ], // Array of strings where each string is a line in the input. They are joined by \n
  "expectedOutput": [ " " ], // Array of strings where each string is a line in the expected output. They are joined by \n
  // io --- end
  // junit/pyunit --- start
  "unitTest": "", // The test to be injected in the shell file, after being escaped
  // junit/pyunit --- end
  // output --- start
  "expectedOutput": [ " " ], // Array of strings where each string is a line in the expected output. They are joined by \n
  // output --- end
}
```

## Example Schema
```JSON
{
  "file": "Solution.java",
  "language": "java",
  "className": "Solution",
  "folder": "examples/inputOutput/",
  "tests": [
    {
      "type": "javaStyle"
    },
    {
      "type": "io",
      "description": "Testing normal boundaries",
      "input": [
        "3",
        "1",
        "2",
        "3"
      ],
      "expectedOutput": [
        "1",
        "2",
        "3"
      ]
    },
    {
      "type": "io",
      "input": [
        "2",
        "2",
        "5"
      ],
      "expectedOutput": [
        "2",
        "5"
      ]
    },
    {
      "type": "junit",
      "unitTest": "@Test\n  public void adderWorksWithZero() {\n    Solution s = new Solution();\n    int actual = s.adder(0, 3);\n    assertEquals(3, actual);\n  }"
    }
  ],
  "outfile": ""
}
```
Output: (Order may vary as tasks are finished by the job worker)
```JSON
[  
   {  
      "test":{  
         "type":"javaStyle",
         "description":"",
         "input":null,
         "expectedOutput":null,
         "unitTest":""
      },
      "description":"Results generated by Checkstyle. A static analyzer built for analyzing Java Programs.",
      "stdOut":"Starting audit...\n[WARN] /Users/john/projects/dissertation/grader/examples/inputOutput/Solution.java:1: Using the '.*' form of import should be avoided - java.util.*. [AvoidStarImport]\n[WARN] /Users/john/projects/dissertation/grader/examples/inputOutput/Solution.java:4:3: Missing a Javadoc comment. [JavadocMethod]\n[WARN] /Users/john/projects/dissertation/grader/examples/inputOutput/Solution.java:16: Comment has incorrect indentation level 0, expected is 2, indentation should be the same level as line 18. [CommentsIndentation]\n[WARN] /Users/john/projects/dissertation/grader/examples/inputOutput/Solution.java:16: Line is longer than 100 characters (found 211). [LineLength]\nAudit done.",
      "stdErr":"",
      "successful":false,
      "similarity":0,
      "timedOut":false
   },
   {  
      "test":{  
         "type":"io",
         "description":"Testing normal boundaries",
         "input":[  
            "3",
            "1",
            "2",
            "3"
         ],
         "expectedOutput":[  
            "1",
            "2",
            "3"
         ],
         "unitTest":""
      },
      "description":"Expected:\n1\n2\n3\nGot:\n1\n2\n3\nTest passed: true",
      "stdOut":"1\n2\n3",
      "stdErr":"",
      "successful":true,
      "similarity":1,
      "timedOut":false
   },
   {  
      "test":{  
         "type":"io",
         "description":"",
         "input":[  
            "2",
            "2",
            "5"
         ],
         "expectedOutput":[  
            "2",
            "5"
         ],
         "unitTest":""
      },
      "description":"Expected:\n2\n5\nGot:\n2\n5\nTest passed: true",
      "stdOut":"2\n5",
      "stdErr":"",
      "successful":true,
      "similarity":1,
      "timedOut":false
   },
   {  
      "test":{  
         "type":"junit",
         "description":"",
         "input":null,
         "expectedOutput":null,
         "unitTest":"@Test\n  public void adderWorksWithZero() {\n    Solution s = new Solution();\n    int actual = s.adder(0, 3);\n    assertEquals(3, actual);\n  }"
      },
      "description":"",
      "stdOut":"JUnit version 4.10\r\n.\r\nTime: 0.009\r\n\r\nOK (1 test)",
      "stdErr":"",
      "successful":true,
      "similarity":0,
      "timedOut":false
   }
]
```
